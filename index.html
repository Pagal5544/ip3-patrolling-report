<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Patrolling Report</title>

<style>
body{font-family:Arial;background:#f4f4f4;margin:20px}
h2{text-align:center}
table{border-collapse:collapse;margin:auto;background:#fff}
th,td{border:2px solid #000;padding:12px 30px;text-align:center;font-weight:700}
th{background:#d6e6fa}
.km{background:#00e600}
.late td:not(.km){background:red;color:#fff}
.top{text-align:center;margin-bottom:10px}
</style>

<script>
function cleanAddress(a){
  if(!a) return "";
  return a
    .replace("OHEHECTOMETERPOST","KM ")
    .replace("CENTERLINEOF","")
    .replace("CH-ALJN","")
    .trim();
}

function loadData(){
  fetch("data/status.json?v=" + Date.now())
  .then(r=>r.json())
  .then(data=>{
    document.getElementById("reportTime").innerText =
      data.meta.generated_at || "";

    document.getElementById("siteTime").innerText =
      new Date().toLocaleString("hi-IN");

    const tb=document.getElementById("body");
    tb.innerHTML="";
    Object.entries(data.devices).forEach(([p,v])=>{
      const tr=document.createElement("tr");
      if(v.end_time < "07:00") tr.className="late";
      tr.innerHTML=`
        <td>${p}</td>
        <td>${v.end_time}</td>
        <td class="km">${v.km}</td>
        <td>${cleanAddress(v.end_address)}</td>
      `;
      tb.appendChild(tr);
    });
  });
}
</script>
</head>

<body onload="loadData()">

<h2>à¤°à¤¾à¤œà¤˜à¤¾à¤Ÿ Night Patrolling Report</h2>

<div class="top">
  <b>Website Updated:</b> <span id="siteTime"></span><br>
  <b>Report Generated:</b> <span id="reportTime"></span><br><br>
  <button onclick="loadData()">ðŸ”„ Refresh</button>
</div>

<table>
<thead>
<tr>
<th>Device</th>
<th>End Time</th>
<th>KM Run</th>
<th>Last Location</th>
</tr>
</thead>
<tbody id="body"></tbody>
</table>

</body>
</html>